define(function(require,exports,module){var e=require("./tool"),t=require("./ansy");require("./tooltip");var n=TEQU.Plugin.option,r=TEQU.Plugin.garams,i="11.1.0",s={menu:"false",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"#000000",salign:"tl",quality:"high",allowFullScreenInteractive:"true"},o={id:"main",style:"min-height: 600px; min-width: 1100px;"};module.exports={init:function(){f(),l(),t.init(),u()}};var u=function(){$("#tetequ").on("click","a",function(){return $(".tetequ-mask,.tetequ-back").show(),!1}).on("click",".tetequ-input-control label",function(){$(this).hide().prev().focus()}).on("focusout",".tetequ-input-control input",function(){$(this).val()||$(this).next().show()}).on("focusin",".tetequ-input-control input",function(){$(this).val()||$(this).next().hide()}).on("click",".tetequ-btn",function(e){p($(this))})},a=function(){return e.md5(location.host+r.uid).substr(8,16)==r.key?!0:!1},f=function(){$("#tetequ").css(n),$("#tetequ").html("<div class='loading'></div>")},l=function(){if(!a()){alert("您进行了跨域嵌入！");return}var t=function(e){$("#tetequ").html(c(e)),$("#tetequ, #tetequ img").css(n)},i=TEQU.path+"/embed/get_room_info?roomid="+r.uid;e.IEXdomain(i,t)},c=function(e){var t='<a href="#"><div class="tetequ_play"></div><img src="'+e.thumb+'"></a><div class="tetequ-mask"></div><div class="tetequ-back"><div class="tetequ-page"><div class="tetequ-input-control tetequ-text tetequ-nick"><input type="text"><label>请输入昵称</label></div><div class="tetequ-input-control tetequ-text tetequ-pwd"><input type="text"><label>请输入邀请码</label></div><div class="tetequ-input-control tetequ-btn"><input type="button" value="进入"></div></div></div>',n='<a href="#"><div class="tetequ_play"></div><img src="'+e.thumb+'"></a><div class="tetequ-mask"></div><div class="tetequ-back"><div class="tetequ-page tetequ-page1"><div class="tetequ-input-control tetequ-text tetequ-nick"><input type="text"><label>请输入昵称</label></div><div class="tetequ-input-control tetequ-btn"><input type="button" value="进入"></div></div></div>';return e.password?t:n},h=function(t){$("body").empty().html("<div id='website'></div>").css({height:"100%"}),e.swfobject.embedSWF(t.main_framework,"website","100%","100%",i,TEQU.path+"/statics/flash/expressInstall.swf",t.flashvars,s,o);var n;window.onbeforeunload=function(){return n=e.swfobject.getObjectById("main"),"你确定要离开吗？"},window.onunload=function(){typeof n.closeConn=="function"&&n.closeConn()}},p=function(t){var n=TEQU.path+"/embed/get_live_param?roomid="+r.uid,i=t.parent().find(".tetequ-nick input").val()?t.parent().find(".tetequ-nick input").val():TEQU.Plugin.city+"网友"+Math.floor(Math.random()*1e4);$(".tetequ-page1").length?n+="&nickname="+i:n+="&nickname="+i+"&password="+t.parent().find(".tetequ-pwd input").val();var s=function(e){if(e.full)return $(".tetequ-nick").tooltip({title:"该房间人数已满，请稍后进入",placement:"top",trigger:""}).tooltip("show"),!1;e.password?$(".tetequ-pwd").tooltip({title:"您输入的密码错误",placement:"top",trigger:""}).tooltip("show"):h(e)};e.IEXdomain(n,s)}})